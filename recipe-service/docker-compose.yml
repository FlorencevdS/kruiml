version: '3.4'

networks:
    recipe-service-dev:
        driver: bridge

services:
    recipe-database:
         image: postgres:latest
         restart: always
         environment:
             POSTGRES_USER: test
             POSTGRES_PASSWORD: test
             POSTGRES_DB: "recipedb"
         ports:
            - 5432:5432
         volumes:
           - pgdata:/var/lib/postgresql/data
         networks:
            - recipe-service-dev
    recipe-service:
        image: recipeservice:latest
        build:
            context: .
            dockerfile: recipe-service/Dockerfile
        ports:
            - 8000:80
        depends_on:
            - "recipe-database"
        networks:
            - recipe-service-dev
        environment:
            DB_CONNECTION_STRING: "host=recipe-database;port=5432;database=recipedb;username=test;password=test"

volumes:
    pgdata: